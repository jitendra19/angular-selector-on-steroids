<!DOCTYPE html>
<html ng-app="myApp"
    ng-controller="ExampleCtrl as ctrl">

    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible"
            content="IE=edge">
        <meta name="viewport"
            content="width=device-width, initial-scale=1">
        <link rel="stylesheet"
            href="./angular-selector.css">
        <style>
            body {
                margin: 30px;
            }
            
            p {
                margin-top: 10px;
            }
            
            dl {
                margin-top: 15px;
            }
            
            .btn-group {
                margin-bottom: 15px;
            }
            
            .checkbox-inline {
                font-weight: bold;
                margin-bottom: 10px;
            }
        </style>
    </head>

    <body>

        <link rel="stylesheet"
            href="https://rawgit.com/Arnoud-B/csscountrycodes/master/flags.css">

        <script type="text/ng-template"
            id="selector/demo/country">
            <i class="flag"
                ng-class="option.code.toLowerCase()"></i>&nbsp; {{option.name}}
        </script>

        <select selector
            model="country"
            value-attr="code"
            debounce="200"
            remote="remote(search)"
            remote-validation="validate(value)"
            view-item-template="'selector/demo/country'"
            dropdown-item-template="'selector/demo/country'"
            placeholder="Choose one or more countries..."></select>

        <p>
            Current value: <code ng-bind="country|json"></code>
        </p>

        <p class="small">
            Icons:
            <a href="https://github.com/Arnoud-B/csscountrycodes"
                target="_blank">
				Arnoud-B/csscountrycodes
			</a>
        </p>

        <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.6.6/angular.js"></script>
        <script src="./angular-selector.js"></script>
        <script>
            angular
                .module('myApp', ['selector'])
                .service('$countries', ['$http', '$q', function($http, $q) {
                    var options = {
                        url: 'http://services.groupkt.com/country/',
                        method: 'GET',
                        cache: true,
                        transformResponse: function(data) {
                            var result = angular.fromJson(data).RestResponse.result;
                            if (!angular.isArray(result)) result = [result];
                            return result.map(function(country) {
                                return {
                                    name: country.name,
                                    code: country.alpha2_code
                                };
                            });
                        }
                    };

                    function Countries() {}
                    Countries.prototype.search = function(search) {
                        if (!search) return $q.resolve([]);
                        var settings = angular.copy(options);
                        settings.url += 'search';
                        settings.params = {
                            text: search
                        };
                        return $http(settings);
                    };
                    Countries.prototype.validate = function(value) {
                        if (!value) return $q.resolve([]);
                        var settings = angular.copy(options);
                        settings.url += 'get/iso2code/' + value;
                        return $http(settings);
                    };

                    return new Countries();
                }])
                .controller('ExampleCtrl', ['$scope', '$countries', function($scope, $countries) {
                    $scope.country = 'SV';

                    $scope.remote = function(search) {
                        return $countries.search(search);
                    };
                    $scope.validate = function(value) {
                        return $countries.validate(value);
                    };
                }]);
        </script>

    </body>

</html>