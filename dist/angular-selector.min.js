/*! angular-selector - v1.5.0 - https://github.com/indrimuska/angular-selector - (c) 2015 Indri Muska - MIT */
var KEYS={up:38,down:40,left:37,right:39,escape:27,enter:13,backspace:8,delete:46,shift:16,leftCmd:91,rightCmd:93,ctrl:17,alt:18,tab:9},getStyles=function(a){return a instanceof HTMLElement?a.ownerDocument&&a.ownerDocument.defaultView.opener?a.ownerDocument.defaultView.getComputedStyle(a):window.getComputedStyle(a):{}},SelectorDirective=function(){function a(b,c,d,e,f){this.$filter=b,this.$timeout=c,this.$window=d,this.$http=e,this.$q=f,this.restrict="EAC",this.replace=!0,this.transclude=!0,this.templateUrl="selector/selector.html",this.scope={name:"@?",value:"=model",disabled:"=?disable",disableSearch:"=?",required:"=?require",multiple:"=?multi",placeholder:"@?",valueAttr:"@",labelAttr:"@?",groupAttr:"@?",options:"=?",debounce:"=?",create:"&?",limit:"=?",rtl:"=?",api:"=?",change:"&?",remote:"&?",remoteParam:"@?",remoteValidation:"&?",remoteValidationParam:"@?",removeButton:"=?",softDelete:"=?",closeAfterSelection:"=?",viewItemTemplate:"=?",dropdownItemTemplate:"=?",dropdownCreateTemplate:"=?",dropdownGroupTemplate:"=?"},a.prototype.link=function(a,g,h,i,j){j(a,function(a,i){var j=b("filter"),k=angular.element(g[0].querySelector(".selector-input input")),l=angular.element(g[0].querySelector(".selector-dropdown")),m=k.controller("ngModel"),n=g.find("select").controller("ngModel"),o=f.defer(),p={api:{},search:"",disableSearch:!1,selectedValues:[],highlighted:0,valueAttr:null,labelAttr:"label",groupAttr:"group",options:[],debounce:0,limit:1/0,remoteParam:"q",remoteValidationParam:"value",removeButton:!0,viewItemTemplate:"selector/item-default.html",dropdownItemTemplate:"selector/item-default.html",dropdownCreateTemplate:"selector/item-create.html",dropdownGroupTemplate:"selector/group-default.html"};!angular.isDefined(i.value)&&i.multiple&&(i.value=[]),angular.forEach(p,function(a,b){angular.isDefined(i[b])||(i[b]=a)}),angular.forEach(["name","valueAttr","labelAttr"],function(a){h[a]||(h[a]=i[a])}),i.getObjValue=function(a,b){var c;if(!angular.isDefined(a)||!angular.isDefined(b))return a;if(b=angular.isArray(b)?b:b.split("."),c=b.shift(),c.indexOf("[")>0){var d=c.match(/(\w+)\[(\d+)\]/);null!==d&&(a=a[d[1]],c=d[2])}return 0===b.length?a[c]:i.getObjValue(a[c],b)},i.setObjValue=function(a,b,c){var d;if(angular.isDefined(a)||(a={}),b=angular.isArray(b)?b:b.split("."),d=b.shift(),d.indexOf("[")>0){var e=d.match(/(\w+)\[(\d+)\]/);null!==e&&(a=a[e[1]],d=e[2])}return a[d]=0===b.length?c:i.setObjValue(a[d],b,c),a},i.optionValue=function(a){return null==i.valueAttr?a:i.getObjValue(a,i.valueAttr)},i.optionEquals=function(a,b){return angular.equals(i.optionValue(a),angular.isDefined(b)?b:i.value)},i.setValue=function(a){i.multiple?i.value=null==i.valueAttr?a||[]:(a||[]).map(function(a){return i.getObjValue(a,i.valueAttr)}):i.value=null==i.valueAttr?a:i.getObjValue(a||{},i.valueAttr)},i.hasValue=function(){return i.multiple?(i.value||[]).length>0:!!i.value},i.request=function(a,b,c,d){var g,h={};if(i.disabled)return f.reject();if(!angular.isDefined(c))throw"Remote attribute is not defined";if(i.loading=!0,i.options=[],h[a]=b,g=c(h),"function"!=typeof g.then){var j={method:"GET",cache:!0,params:{}};angular.extend(j,g),angular.extend(j.params,g.params),j.params[d]=b,g=e(j)}return g.then(function(a){i.options=a.data||a,i.filterOptions(),i.loading=!1,o.resolve()},function(a){throw i.loading=!1,o.reject(),"Error while fetching data: "+(a.message||a)}),g},i.fetch=function(){return i.request("search",i.search||"",i.remote,i.remoteParam)},i.fetchValidation=function(a){return i.request("value",a,i.remoteValidation,i.remoteValidationParam)},angular.isDefined(i.remote)?angular.isDefined(i.remoteValidation)||(i.remoteValidation=!1):(i.remote=!1,i.remoteValidation=!1,o.resolve()),i.remote&&c(function(){f.when(i.hasValue()&&i.remoteValidation?i.fetchValidation(i.value):angular.noop).then(function(){i.$watch("search",function(){c(i.fetch)})})}),i.optionToObject=function(a,b){var c={},d=angular.element(a);angular.forEach(a.dataset,function(a,b){b.match(/^\$/)||(c[b]=a)}),a.value&&i.setObjValue(c,i.valueAttr||"value",a.value),d.text()&&i.setObjValue(c,i.labelAttr,d.text().trim()),angular.isDefined(b)&&i.setObjValue(c,i.groupAttr,b),i.options.push(c),!d.attr("selected")||!i.multiple&&i.hasValue()||(i.multiple?(i.value||(i.value=[]),i.value.push(i.optionValue(c))):i.value||(i.value=i.optionValue(c)))},i.fillWithHtml=function(){i.options=[],angular.forEach(a,function(a){var b=(a.tagName||"").toLowerCase();"option"==b&&i.optionToObject(a),"optgroup"==b&&angular.forEach(a.querySelectorAll("option"),function(b){i.optionToObject(b,(a.attributes.label||{}).value)})}),i.updateSelected()},i.initialize=function(){i.remote||angular.isArray(i.options)&&i.options.length||i.fillWithHtml(),i.hasValue()&&(i.multiple?angular.isArray(i.value)||(i.value=[i.value]):angular.isArray(i.value)&&(i.value=i.value[0]),i.updateSelected(),i.filterOptions(),i.updateValue())},i.$watch("multiple",function(){c(i.setInputWidth),o.promise.then(i.initialize,i.initialize)}),i.dropdownPosition=function(){var a=k.parent()[0],b=getStyles(a),c=parseFloat(b.marginTop||0),d=parseFloat(b.marginLeft||0);a&&l.css({top:a.offsetTop+a.offsetHeight+c+"px",left:a.offsetLeft+d+"px",width:a.offsetWidth+"px"})},i.open=function(){i.multiple&&(i.selectedValues||[]).length>=i.limit||(i.isOpen=!0,i.dropdownPosition(),c(i.scrollToHighlighted))},i.close=function(){i.isOpen=!1,i.resetInput(),i.remote&&c(i.fetch)},i.decrementHighlighted=function(){i.highlight(i.highlighted-1),i.scrollToHighlighted()},i.incrementHighlighted=function(){i.highlight(i.highlighted+1),i.scrollToHighlighted()},i.highlight=function(a){h.create&&i.search&&-1==a?i.highlighted=-1:i.filteredOptions.length&&(i.highlighted=(i.filteredOptions.length+a)%i.filteredOptions.length)},i.scrollToHighlighted=function(){var a=l[0],b=a.querySelectorAll("li.selector-option")[i.highlighted],d=getStyles(b),e=parseFloat(d.marginTop||0),f=parseFloat(d.marginBottom||0);i.filteredOptions.length&&(b.offsetTop+b.offsetHeight+f>a.scrollTop+a.offsetHeight&&c(function(){a.scrollTop=b.offsetTop+b.offsetHeight+f-a.offsetHeight}),b.offsetTop-e<a.scrollTop&&c(function(){a.scrollTop=b.offsetTop-e}))},i.createOption=function(a){f.when(function(){var b={};return angular.isFunction(i.create)?b=i.create({input:a}):(i.setObjValue(b,i.labelAttr,a),i.setObjValue(b,i.valueAttr||"value",a)),b}()).then(function(a){i.options.push(a),i.set(a)})},i.set=function(a){i.multiple&&(i.selectedValues||[]).length>=i.limit||(angular.isDefined(a)||(a=i.filteredOptions[i.highlighted]),i.multiple?(i.selectedValues||(i.selectedValues=[]),i.selectedValues.indexOf(a)<0&&i.selectedValues.push(a)):i.selectedValues=[a],(!i.multiple||i.closeAfterSelection||(i.selectedValues||[]).length>=i.limit)&&i.close(),i.resetInput(),n.$setDirty())},i.unset=function(a){i.multiple?i.selectedValues.splice(angular.isDefined(a)?a:i.selectedValues.length-1,1):i.selectedValues=[],i.resetInput(),n.$setDirty()},i.keydown=function(a){switch(a.keyCode){case KEYS.up:if(!i.isOpen)break;i.decrementHighlighted(),a.preventDefault();break;case KEYS.down:i.isOpen?i.incrementHighlighted():i.open(),a.preventDefault();break;case KEYS.escape:i.highlight(0),i.close();break;case KEYS.enter:i.isOpen&&(h.create&&i.search&&-1==i.highlighted?i.createOption(a.target.value):i.filteredOptions.length&&i.set(),a.preventDefault());break;case KEYS.backspace:if(!k.val()){var b=i.getObjValue(i.selectedValues.slice(-1)[0]||{},i.labelAttr||"");i.unset(),i.open(),i.softDelete&&!i.disableSearch&&c(function(){i.search=b}),a.preventDefault()}break;case KEYS.left:case KEYS.right:case KEYS.shift:case KEYS.ctrl:case KEYS.alt:case KEYS.tab:case KEYS.leftCmd:case KEYS.rightCmd:break;default:!i.multiple&&i.hasValue()?a.preventDefault():(i.open(),i.highlight(0))}},i.inOptions=function(a,b){return i.remote?a.filter(function(a){return angular.equals(b,a)}).length>0:a.indexOf(b)>=0},i.filterOptions=function(){if(i.filteredOptions=j(i.options||[],i.search),angular.isArray(i.selectedValues)||(i.selectedValues=[]),i.multiple)i.filteredOptions=i.filteredOptions.filter(function(a){return!i.inOptions(i.selectedValues,a)});else{var a=i.filteredOptions.indexOf(i.selectedValues[0]);a>=0&&i.highlight(a)}},i.measureWidth=function(){var a,b=getStyles(k[0]),c=angular.element('<span class="selector-shadow"></span>');return c.text(k.val()||(i.hasValue()?"":i.placeholder)||""),angular.element(document.body).append(c),angular.forEach(["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent"],function(a){c.css(a,b[a])}),a=c[0].offsetWidth,c.remove(),a},i.setInputWidth=function(){var a=i.measureWidth()+1;k.css("width",a+"px")},i.resetInput=function(){k.val(""),i.setInputWidth(),c(function(){i.search=""})},i.$watch("[search, options, value]",function(){i.filterOptions(),c(function(){i.setInputWidth(),i.isOpen&&i.dropdownPosition()})},!0),i.updateValue=function(a){angular.isDefined(a)||(a=i.selectedValues||[]),i.setValue(i.multiple?a:a[0])},i.$watch("selectedValues",function(a,b){angular.equals(a,b)||(i.updateValue(),angular.isFunction(i.change)&&i.change(i.multiple?{newValue:a,oldValue:b}:{newValue:(a||[])[0],oldValue:(b||[])[0]}))},!0),i.$watchCollection("options",function(a,b){angular.equals(a,b)||i.remote||i.updateSelected()}),i.updateSelected=function(){i.multiple?i.selectedValues=(i.value||[]).map(function(a){return j(i.options,function(b){return i.optionEquals(b,a)})[0]}).filter(function(a){return angular.isDefined(a)}).slice(0,i.limit):i.selectedValues=(i.options||[]).filter(function(a){return i.optionEquals(a)}).slice(0,1)},i.$watch("value",function(a,b){angular.equals(a,b)||f.when(i.remote&&i.remoteValidation&&i.hasValue()?i.fetchValidation(a):angular.noop).then(function(){i.updateSelected(),i.filterOptions(),i.updateValue()})},!0),k=angular.element(g[0].querySelector(".selector-input input")).on("focus",function(){c(function(){i.$apply(i.open)})}).on("blur",function(){i.$apply(i.close)}).on("keydown",function(a){i.$apply(function(){i.keydown(a)})}).on("input",function(){i.setInputWidth()}),l.on("mousedown",function(a){a.preventDefault()}),angular.element(d).on("resize",function(){i.dropdownPosition()}),i.$watch(function(){return m.$pristine},function(a){n[a?"$setPristine":"$setDirty"]()}),i.$watch(function(){return m.$touched},function(a){n[a?"$setTouched":"$setUntouched"]()}),angular.forEach(["open","close","fetch"],function(a){i.api[a]=i[a]}),i.api.focus=function(){k[0].focus()},i.api.set=function(a){return i.value=a},i.api.unset=function(a){var b=a?(i.selectedValues||[]).filter(function(b){return i.optionEquals(b,a)}):i.selectedValues,c=i.selectedValues.map(function(a,c){return i.inOptions(b,a)?c:-1}).filter(function(a){return a>=0});angular.forEach(c,function(a,b){i.unset(a-b)})}})}}return a.Factory=function(){var b=function(b,c,d,e,f){return new a(b,c,d,e,f)};return b.$inject=["$filter","$timeout","$window","$http","$q"],b},a}(),$filter,$timeout,$window,$http,$q,Selector=function(){function a(a,b,c,d,e){this.restrict="EAC",this.replace=!0,this.transclude=!0,this.scope={name:"@?",value:"=model",disabled:"=?disable",disableSearch:"=?",required:"=?require",multiple:"=?multi",placeholder:"@?",valueAttr:"@",labelAttr:"@?",groupAttr:"@?",options:"=?",debounce:"=?",create:"&?",limit:"=?",rtl:"=?",api:"=?",change:"&?",remote:"&?",remoteParam:"@?",remoteValidation:"&?",remoteValidationParam:"@?",removeButton:"=?",softDelete:"=?",closeAfterSelection:"=?",viewItemTemplate:"=?",dropdownItemTemplate:"=?",dropdownCreateTemplate:"=?",dropdownGroupTemplate:"=?"},this.templateUrl="selector/selector.html",$filter=a,$timeout=b,$window=c,$http=d,$q=e}return a.prototype.$inject=["$filter","$timeout","$window","$http","$q"],a.prototype.link=function(a,b,c,d,e){e(a,function(a,d){var e=$filter("filter"),f=angular.element(b[0].querySelector(".selector-input input")),g=angular.element(b[0].querySelector(".selector-dropdown")),h=f.controller("ngModel"),i=b.find("select").controller("ngModel"),j=$q.defer(),k={api:{},search:"",disableSearch:!1,selectedValues:[],highlighted:0,valueAttr:null,labelAttr:"label",groupAttr:"group",options:[],debounce:0,limit:1/0,remoteParam:"q",remoteValidationParam:"value",removeButton:!0,viewItemTemplate:"selector/item-default.html",dropdownItemTemplate:"selector/item-default.html",dropdownCreateTemplate:"selector/item-create.html",dropdownGroupTemplate:"selector/group-default.html"};!angular.isDefined(d.value)&&d.multiple&&(d.value=[]),angular.forEach(k,function(a,b){angular.isDefined(d[b])||(d[b]=a)}),angular.forEach(["name","valueAttr","labelAttr"],function(a){c[a]||(c[a]=d[a])}),d.getObjValue=function(a,b){var c;if(!angular.isDefined(a)||!angular.isDefined(b))return a;if(b=angular.isArray(b)?b:b.split("."),c=b.shift(),c.indexOf("[")>0){var e=c.match(/(\w+)\[(\d+)\]/);null!==e&&(a=a[e[1]],c=e[2])}return 0===b.length?a[c]:d.getObjValue(a[c],b)},d.setObjValue=function(a,b,c){var e;if(angular.isDefined(a)||(a={}),b=angular.isArray(b)?b:b.split("."),e=b.shift(),e.indexOf("[")>0){var f=e.match(/(\w+)\[(\d+)\]/);null!==f&&(a=a[f[1]],e=f[2])}return a[e]=0===b.length?c:d.setObjValue(a[e],b,c),a},d.optionValue=function(a){return null==d.valueAttr?a:d.getObjValue(a,d.valueAttr)},d.optionEquals=function(a,b){return angular.equals(d.optionValue(a),angular.isDefined(b)?b:d.value)},d.setValue=function(a){d.multiple?d.value=null==d.valueAttr?a||[]:(a||[]).map(function(a){return d.getObjValue(a,d.valueAttr)}):d.value=null==d.valueAttr?a:d.getObjValue(a||{},d.valueAttr)},d.hasValue=function(){return d.multiple?(d.value||[]).length>0:!!d.value},d.request=function(a,b,c,e){var f,g={};if(d.disabled)return $q.reject();if(!angular.isDefined(c))throw"Remote attribute is not defined";if(d.loading=!0,d.options=[],g[a]=b,f=c(g),"function"!=typeof f.then){var h={method:"GET",cache:!0,params:{}};angular.extend(h,f),angular.extend(h.params,f.params),h.params[e]=b,f=$http(h)}return f.then(function(a){d.options=a.data||a,d.filterOptions(),d.loading=!1,j.resolve()},function(a){throw d.loading=!1,j.reject(),"Error while fetching data: "+(a.message||a)}),f},d.fetch=function(){return d.request("search",d.search||"",d.remote,d.remoteParam)},d.fetchValidation=function(a){return d.request("value",a,d.remoteValidation,d.remoteValidationParam)},angular.isDefined(d.remote)?angular.isDefined(d.remoteValidation)||(d.remoteValidation=!1):(d.remote=!1,d.remoteValidation=!1,j.resolve()),d.remote&&$timeout(function(){$q.when(d.hasValue()&&d.remoteValidation?d.fetchValidation(d.value):angular.noop).then(function(){d.$watch("search",function(){$timeout(d.fetch)})})}),d.optionToObject=function(a,b){var c={},e=angular.element(a);angular.forEach(a.dataset,function(a,b){b.match(/^\$/)||(c[b]=a)}),a.value&&d.setObjValue(c,d.valueAttr||"value",a.value),e.text()&&d.setObjValue(c,d.labelAttr,e.text().trim()),angular.isDefined(b)&&d.setObjValue(c,d.groupAttr,b),d.options.push(c),!e.attr("selected")||!d.multiple&&d.hasValue()||(d.multiple?(d.value||(d.value=[]),d.value.push(d.optionValue(c))):d.value||(d.value=d.optionValue(c)))},d.fillWithHtml=function(){d.options=[],angular.forEach(a,function(a){var b=(a.tagName||"").toLowerCase();"option"==b&&d.optionToObject(a),"optgroup"==b&&angular.forEach(a.querySelectorAll("option"),function(b){d.optionToObject(b,(a.attributes.label||{}).value)})}),d.updateSelected()},d.initialize=function(){d.remote||angular.isArray(d.options)&&d.options.length||d.fillWithHtml(),d.hasValue()&&(d.multiple?angular.isArray(d.value)||(d.value=[d.value]):angular.isArray(d.value)&&(d.value=d.value[0]),d.updateSelected(),d.filterOptions(),d.updateValue())},d.$watch("multiple",function(){$timeout(d.setInputWidth),j.promise.then(d.initialize,d.initialize)}),d.dropdownPosition=function(){var a=f.parent()[0],b=getStyles(a),c=parseFloat(b.marginTop||0),d=parseFloat(b.marginLeft||0);a&&g.css({top:a.offsetTop+a.offsetHeight+c+"px",left:a.offsetLeft+d+"px",width:a.offsetWidth+"px"})},d.open=function(){d.multiple&&(d.selectedValues||[]).length>=d.limit||(d.isOpen=!0,d.dropdownPosition(),$timeout(d.scrollToHighlighted))},d.close=function(){d.isOpen=!1,d.resetInput(),d.remote&&$timeout(d.fetch)},d.decrementHighlighted=function(){d.highlight(d.highlighted-1),d.scrollToHighlighted()},d.incrementHighlighted=function(){d.highlight(d.highlighted+1),d.scrollToHighlighted()},d.highlight=function(a){c.create&&d.search&&-1==a?d.highlighted=-1:d.filteredOptions.length&&(d.highlighted=(d.filteredOptions.length+a)%d.filteredOptions.length)},d.scrollToHighlighted=function(){var a=g[0],b=a.querySelectorAll("li.selector-option")[d.highlighted],c=getStyles(b),e=parseFloat(c.marginTop||0),f=parseFloat(c.marginBottom||0);d.filteredOptions.length&&(b.offsetTop+b.offsetHeight+f>a.scrollTop+a.offsetHeight&&$timeout(function(){a.scrollTop=b.offsetTop+b.offsetHeight+f-a.offsetHeight}),b.offsetTop-e<a.scrollTop&&$timeout(function(){a.scrollTop=b.offsetTop-e}))},d.createOption=function(a){$q.when(function(){var b={};return angular.isFunction(d.create)?b=d.create({input:a}):(d.setObjValue(b,d.labelAttr,a),d.setObjValue(b,d.valueAttr||"value",a)),b}()).then(function(a){d.options.push(a),d.set(a)})},d.set=function(a){d.multiple&&(d.selectedValues||[]).length>=d.limit||(angular.isDefined(a)||(a=d.filteredOptions[d.highlighted]),d.multiple?(d.selectedValues||(d.selectedValues=[]),d.selectedValues.indexOf(a)<0&&d.selectedValues.push(a)):d.selectedValues=[a],(!d.multiple||d.closeAfterSelection||(d.selectedValues||[]).length>=d.limit)&&d.close(),d.resetInput(),i.$setDirty())},d.unset=function(a){d.multiple?d.selectedValues.splice(angular.isDefined(a)?a:d.selectedValues.length-1,1):d.selectedValues=[],d.resetInput(),i.$setDirty()},d.keydown=function(a){switch(a.keyCode){case KEYS.up:if(!d.isOpen)break;d.decrementHighlighted(),a.preventDefault();break;case KEYS.down:d.isOpen?d.incrementHighlighted():d.open(),a.preventDefault();break;case KEYS.escape:d.highlight(0),d.close();break;case KEYS.enter:d.isOpen&&(c.create&&d.search&&-1==d.highlighted?d.createOption(a.target.value):d.filteredOptions.length&&d.set(),a.preventDefault());break;case KEYS.backspace:if(!f.val()){var b=d.getObjValue(d.selectedValues.slice(-1)[0]||{},d.labelAttr||"");d.unset(),d.open(),d.softDelete&&!d.disableSearch&&$timeout(function(){d.search=b}),a.preventDefault()}break;case KEYS.left:case KEYS.right:case KEYS.shift:case KEYS.ctrl:case KEYS.alt:case KEYS.tab:case KEYS.leftCmd:case KEYS.rightCmd:break;default:!d.multiple&&d.hasValue()?a.preventDefault():(d.open(),d.highlight(0))}},d.inOptions=function(a,b){return d.remote?a.filter(function(a){return angular.equals(b,a)}).length>0:a.indexOf(b)>=0},d.filterOptions=function(){if(d.filteredOptions=e(d.options||[],d.search),angular.isArray(d.selectedValues)||(d.selectedValues=[]),d.multiple)d.filteredOptions=d.filteredOptions.filter(function(a){return!d.inOptions(d.selectedValues,a)});else{var a=d.filteredOptions.indexOf(d.selectedValues[0]);a>=0&&d.highlight(a)}},d.measureWidth=function(){var a,b=getStyles(f[0]),c=angular.element('<span class="selector-shadow"></span>');return c.text(f.val()||(d.hasValue()?"":d.placeholder)||""),angular.element(document.body).append(c),angular.forEach(["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent"],function(a){c.css(a,b[a])}),a=c[0].offsetWidth,c.remove(),a},d.setInputWidth=function(){var a=d.measureWidth()+1;f.css("width",a+"px")},d.resetInput=function(){f.val(""),d.setInputWidth(),$timeout(function(){d.search=""})},d.$watch("[search, options, value]",function(){d.filterOptions(),$timeout(function(){d.setInputWidth(),d.isOpen&&d.dropdownPosition()})},!0),d.updateValue=function(a){angular.isDefined(a)||(a=d.selectedValues||[]),d.setValue(d.multiple?a:a[0])},d.$watch("selectedValues",function(a,b){angular.equals(a,b)||(d.updateValue(),angular.isFunction(d.change)&&d.change(d.multiple?{newValue:a,oldValue:b}:{newValue:(a||[])[0],oldValue:(b||[])[0]}))},!0),d.$watchCollection("options",function(a,b){angular.equals(a,b)||d.remote||d.updateSelected()}),d.updateSelected=function(){d.multiple?d.selectedValues=(d.value||[]).map(function(a){return e(d.options,function(b){return d.optionEquals(b,a)})[0]}).filter(function(a){return angular.isDefined(a)}).slice(0,d.limit):d.selectedValues=(d.options||[]).filter(function(a){return d.optionEquals(a)}).slice(0,1)},d.$watch("value",function(a,b){angular.equals(a,b)||$q.when(d.remote&&d.remoteValidation&&d.hasValue()?d.fetchValidation(a):angular.noop).then(function(){d.updateSelected(),d.filterOptions(),d.updateValue()})},!0),f=angular.element(b[0].querySelector(".selector-input input")).on("focus",function(){$timeout(function(){d.$apply(d.open)})}).on("blur",function(){d.$apply(d.close)}).on("keydown",function(a){d.$apply(function(){d.keydown(a)})}).on("input",function(){d.setInputWidth()}),g.on("mousedown",function(a){a.preventDefault()}),angular.element($window).on("resize",function(){d.dropdownPosition()}),d.$watch(function(){return h.$pristine},function(a){i[a?"$setPristine":"$setDirty"]()}),d.$watch(function(){return h.$touched},function(a){i[a?"$setTouched":"$setUntouched"]()}),angular.forEach(["open","close","fetch"],function(a){d.api[a]=d[a]}),d.api.focus=function(){f[0].focus()},d.api.set=function(a){return d.value=a},d.api.unset=function(a){var b=a?(d.selectedValues||[]).filter(function(b){return d.optionEquals(b,a)}):d.selectedValues,c=d.selectedValues.map(function(a,c){return d.inOptions(b,a)?c:-1}).filter(function(a){return a>=0});angular.forEach(c,function(a,b){d.unset(a-b)})}})},a}();angular.module("selector",[]).run(["$templateCache",function(a){a.put("selector/selector.html",'<div class="selector-container" ng-attr-dir="{{rtl ? \'rtl\' : \'ltr\'}}" ng-class="{open: isOpen, empty: !filteredOptions.length && (!create || !search), multiple: multiple, \'has-value\': hasValue(), rtl: rtl, loading: loading, \'remove-button\': removeButton, disabled: disabled}"><select name="{{name}}" ng-hide="true" ng-required="required && !hasValue()" ng-model="selectedValues" multiple ng-options="option as getObjValue(option, labelAttr) for option in selectedValues"></select><label class="selector-input"><ul class="selector-values"><li ng-repeat="(index, option) in selectedValues track by index"><div ng-include="viewItemTemplate"></div><div ng-if="multiple" class="selector-helper" ng-click="!disabled && unset(index)"><span class="selector-icon"></span></div></li></ul><input ng-model="search" placeholder="{{!hasValue() ? placeholder : \'\'}}" ng-model-options="{debounce: debounce}"ng-disabled="disabled" ng-readonly="disableSearch" ng-required="required && !hasValue()" autocomplete="off"><div ng-if="!multiple || loading" class="selector-helper selector-global-helper" ng-click="!disabled && removeButton && unset()"><span class="selector-icon"></span></div></label><ul class="selector-dropdown" ng-show="filteredOptions.length > 0 || (create && search)"><li class="selector-option create" ng-class="{active: highlighted == -1}" ng-if="create && search" ng-include="dropdownCreateTemplate" ng-mouseover="highlight(-1)" ng-click="createOption(search)"></li><li ng-repeat-start="(index, option) in filteredOptions track by index" class="selector-optgroup" ng-include="dropdownGroupTemplate" ng-show="groupAttr && (getObjValue(option, groupAttr) && index == 0 || getObjValue(filteredOptions[index - 1], groupAttr) != getObjValue(option, groupAttr))"></li><li ng-repeat-end ng-class="{active: highlighted == index, grouped: groupAttr && getObjValue(option, groupAttr)}" class="selector-option" ng-include="dropdownItemTemplate" ng-mouseover="highlight(index)" ng-click="set()"></li></ul></div>'),a.put("selector/item-create.html",'Add <i ng-bind="search"></i>'),a.put("selector/item-default.html",'<span ng-bind="getObjValue(option, labelAttr) || option"></span>'),a.put("selector/group-default.html",'<span ng-bind="getObjValue(option, groupAttr)"></span>')}]).directive("selector",SelectorDirective.Factory());