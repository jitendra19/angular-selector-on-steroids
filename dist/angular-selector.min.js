/*! angular-selector - v1.5.0 - https://github.com/indrimuska/angular-selector - (c) 2015 Indri Muska - MIT */
var CONSTANTS={KEYS:{up:38,down:40,left:37,right:39,escape:27,enter:13,backspace:8,delete:46,shift:16,leftCmd:91,rightCmd:93,ctrl:17,alt:18,tab:9},TEMPLATES:{SELECTOR:'\n        <div class="selector-container"\n            ng-attr-dir="{{ rtl ? \'rtl\' : \'ltr\' }}"\n            ng-class="{\n                open: isOpen, \n                empty: !filteredOptions.length && \n                    (!create || !search), multiple: multiple, \n                    \'has-value\': hasValue(), \n                    rtl: rtl, \n                    \'loading\': loading, \n                    \'remove-button\': removeButton, \n                    disabled: disabled}">\n            <select name="{{name}}"\n                ng-hide="true"\n                ng-required="required && !hasValue()"\n                ng-model="selectedValues"\n                multiple\n                ng-options="option as getObjValue(option, labelAttr) for option in selectedValues">\n            </select>\n            <label class="selector-input">\n                <ul class="selector-values">\n                    <li ng-repeat="(index, option) in selectedValues track by index">\n                        <div ng-include="viewItemTemplate"></div>\n                        <div ng-if="multiple" class="selector-helper" ng-click="!disabled && unset(index)">\n                            <span class="selector-icon"></span>\n                        </div>\n                    </li>\n                </ul>\n                <input \n                    ng-model="search" \n                    placeholder="{{!hasValue() ? placeholder : \'\'}}" \n                    ng-model-options="{debounce: debounce}"\n                    ng-disabled="disabled" \n                    ng-readonly="disableSearch" \n                    ng-required="required && !hasValue()" \n                    autocomplete="off">\n                <div ng-if="!multiple || loading" \n                    class="selector-helper selector-global-helper" \n                    ng-click="!disabled && removeButton && unset()">\n                    <span class="selector-icon"></span>\n                </div>\n            </label>\n            <ul class="selector-dropdown"\n                ng-show="filteredOptions.length > 0 || (create && search)">\n                <li class="selector-option create"\n                    ng-class="{active: highlighted == -1}"\n                    ng-if="create && search"\n                    ng-include="dropdownCreateTemplate"\n                    ng-mouseover="highlight(-1)"\n                    ng-click="createOption(search)"></li>\n                <li ng-repeat-start="(index, option) in filteredOptions track by index"\n                    class="selector-optgroup"\n                    ng-include="dropdownGroupTemplate"\n                    ng-show="groupAttr && (getObjValue(option, groupAttr) && index == 0 || getObjValue(filteredOptions[index - 1], groupAttr) != getObjValue(option, groupAttr))"></li>\n                <li ng-repeat-end\n                    ng-class="{active: highlighted == index, grouped: groupAttr && getObjValue(option, groupAttr)}"\n                    class="selector-option"\n                    ng-include="dropdownItemTemplate"\n                    ng-mouseover="highlight(index)"\n                    ng-click="set()">\n                </li>\n            </ul>\n        </div>',ITEM_CREATE:'Add <i ng-bind="search"></i>',ITEM_DEFAULT:'<span ng-bind="getObjValue(option, labelAttr) || option"></span>',GROUP_DEFAULT:'<span ng-bind="getObjValue(option, groupAttr)"></span>'}},DOM_FUNCTIONS={getStyles:function(a){return a instanceof HTMLElement?a.ownerDocument&&a.ownerDocument.defaultView.opener?a.ownerDocument.defaultView.getComputedStyle(a):window.getComputedStyle(a):{}}},SelectorDirective=function(){function a(b,c,d,e,f){this.$filter=b,this.$timeout=c,this.$window=d,this.$http=e,this.$q=f,this.restrict="EAC",this.replace=!0,this.transclude=!0,this.templateUrl="selector/selector.html",this.scope={name:"@?",value:"=model",disabled:"=?disable",disableSearch:"=?",required:"=?require",multiple:"=?multi",placeholder:"@?",valueAttr:"@",labelAttr:"@?",groupAttr:"@?",options:"=?",debounce:"=?",create:"&?",limit:"=?",rtl:"=?",api:"=?",change:"&?",remote:"&?",remoteParam:"@?",remoteValidation:"&?",remoteValidationParam:"@?",removeButton:"=?",softDelete:"=?",closeAfterSelection:"=?",viewItemTemplate:"=?",dropdownItemTemplate:"=?",dropdownCreateTemplate:"=?",dropdownGroupTemplate:"=?"},a.prototype.link=function(a,g,h,i,j){j(a,function(a,i){var j=b("filter"),k=angular.element(g[0].querySelector(".selector-input input")),l=angular.element(g[0].querySelector(".selector-dropdown")),m=k.controller("ngModel"),n=g.find("select").controller("ngModel"),o=f.defer(),p={api:{},search:"",disableSearch:!1,selectedValues:[],highlighted:0,valueAttr:null,labelAttr:"label",groupAttr:"group",options:[],debounce:0,limit:1/0,remoteParam:"q",remoteValidationParam:"value",removeButton:!0,viewItemTemplate:"selector/item-default.html",dropdownItemTemplate:"selector/item-default.html",dropdownCreateTemplate:"selector/item-create.html",dropdownGroupTemplate:"selector/group-default.html"};!angular.isDefined(i.value)&&i.multiple&&(i.value=[]),angular.forEach(p,function(a,b){angular.isDefined(i[b])||(i[b]=a)}),angular.forEach(["name","valueAttr","labelAttr"],function(a){h[a]||(h[a]=i[a])});var q=function(a){return null==i.valueAttr?a:i.getObjValue(a,i.valueAttr)},r=function(a,b,c){var d;if(angular.isDefined(a)||(a={}),b=angular.isArray(b)?b:b.split("."),d=b.shift(),d.indexOf("[")>0){var e=d.match(/(\w+)\[(\d+)\]/);null!==e&&(a=a[e[1]],d=e[2])}return a[d]=0===b.length?c:r(a[d],b,c),a},s=function(a,b){return angular.equals(q(a),angular.isDefined(b)?b:i.value)};i.getObjValue=function(a,b){var c;if(!angular.isDefined(a)||!angular.isDefined(b))return a;if(b=angular.isArray(b)?b:b.split("."),c=b.shift(),c.indexOf("[")>0){var d=c.match(/(\w+)\[(\d+)\]/);null!==d&&(a=a[d[1]],c=d[2])}return 0===b.length?a[c]:i.getObjValue(a[c],b)};var t=function(a){i.multiple?i.value=null==i.valueAttr?a||[]:(a||[]).map(function(a){return i.getObjValue(a,i.valueAttr)}):i.value=null==i.valueAttr?a:i.getObjValue(a||{},i.valueAttr)};i.hasValue=function(){return i.multiple?(i.value||[]).length>0:!!i.value};var u=function(a,b,c,d){var g,h={};if(i.disabled)return f.reject();if(!angular.isDefined(c))throw"Remote attribute is not defined";if(i.loading=!0,i.options=[],h[a]=b,g=c(h),"function"!=typeof g.then){var j={method:"GET",cache:!0,params:{}};angular.extend(j,g),angular.extend(j.params,g.params),j.params[d]=b,g=e(j)}return g.then(function(a){i.options=a.data||a,C(),i.loading=!1,o.resolve()},function(a){throw i.loading=!1,o.reject(),"Error while fetching data: "+(a.message||a)}),g},v=function(){return u("search",i.search||"",i.remote,i.remoteParam)},w=function(a){return u("value",a,i.remoteValidation,i.remoteValidationParam)};angular.isDefined(i.remote)?angular.isDefined(i.remoteValidation)||(i.remoteValidation=!1):(i.remote=!1,i.remoteValidation=!1,o.resolve()),i.remote&&c(function(){f.when(i.hasValue()&&i.remoteValidation?w(i.value):angular.noop).then(function(){i.$watch("search",function(){c(v)})})});var x=function(a,b){var c={},d=angular.element(a);angular.forEach(a.dataset,function(a,b){b.match(/^\$/)||(c[b]=a)}),a.value&&r(c,i.valueAttr||"value",a.value),d.text()&&r(c,i.labelAttr,d.text().trim()),angular.isDefined(b)&&r(c,i.groupAttr,b),i.options.push(c),!d.attr("selected")||!i.multiple&&i.hasValue()||(i.multiple?(i.value||(i.value=[]),i.value.push(q(c))):i.value||(i.value=q(c)))},y=function(){i.options=[],angular.forEach(a,function(a){var b=(a.tagName||"").toLowerCase();"option"==b&&x(a),"optgroup"==b&&angular.forEach(a.querySelectorAll("option"),function(b){x(b,(a.attributes.label||{}).value)})}),D()},z=function(){i.remote||angular.isArray(i.options)&&i.options.length||y(),i.hasValue()&&(i.multiple?angular.isArray(i.value)||(i.value=[i.value]):angular.isArray(i.value)&&(i.value=i.value[0]),D(),C(),i.updateValue())};i.$watch("multiple",function(){c(i.setInputWidth),o.promise.then(z,z)}),i.dropdownPosition=function(){var a=k.parent()[0],b=DOM_FUNCTIONS.getStyles(a),c=parseFloat(b.marginTop||0),d=parseFloat(b.marginLeft||0);a&&l.css({top:a.offsetTop+a.offsetHeight+c+"px",left:a.offsetLeft+d+"px",width:a.offsetWidth+"px"})};var A=function(){i.multiple&&(i.selectedValues||[]).length>=i.limit||(i.isOpen=!0,i.dropdownPosition(),c(i.scrollToHighlighted))},B=function(){i.isOpen=!1,i.resetInput(),i.remote&&c(v)};i.decrementHighlighted=function(){i.highlight(i.highlighted-1),i.scrollToHighlighted()},i.incrementHighlighted=function(){i.highlight(i.highlighted+1),i.scrollToHighlighted()},i.highlight=function(a){h.create&&i.search&&-1==a?i.highlighted=-1:i.filteredOptions.length&&(i.highlighted=(i.filteredOptions.length+a)%i.filteredOptions.length)},i.scrollToHighlighted=function(){var a=l[0],b=a.querySelectorAll("li.selector-option")[i.highlighted],d=DOM_FUNCTIONS.getStyles(b),e=parseFloat(d.marginTop||0),f=parseFloat(d.marginBottom||0);i.filteredOptions.length&&(b.offsetTop+b.offsetHeight+f>a.scrollTop+a.offsetHeight&&c(function(){a.scrollTop=b.offsetTop+b.offsetHeight+f-a.offsetHeight}),b.offsetTop-e<a.scrollTop&&c(function(){a.scrollTop=b.offsetTop-e}))},i.createOption=function(a){f.when(function(){var b={};return angular.isFunction(i.create)?b=i.create({input:a}):(r(b,i.labelAttr,a),r(b,i.valueAttr||"value",a)),b}()).then(function(a){i.options.push(a),i.set(a)})},i.set=function(a){i.multiple&&(i.selectedValues||[]).length>=i.limit||(angular.isDefined(a)||(a=i.filteredOptions[i.highlighted]),i.multiple?(i.selectedValues||(i.selectedValues=[]),i.selectedValues.indexOf(a)<0&&i.selectedValues.push(a)):i.selectedValues=[a],(!i.multiple||i.closeAfterSelection||(i.selectedValues||[]).length>=i.limit)&&B(),i.resetInput(),n.$setDirty())},i.unset=function(a){i.multiple?i.selectedValues.splice(angular.isDefined(a)?a:i.selectedValues.length-1,1):i.selectedValues=[],i.resetInput(),n.$setDirty()},i.keydown=function(a){switch(a.keyCode){case CONSTANTS.KEYS.up:if(!i.isOpen)break;i.decrementHighlighted(),a.preventDefault();break;case CONSTANTS.KEYS.down:i.isOpen?i.incrementHighlighted():A(),a.preventDefault();break;case CONSTANTS.KEYS.escape:i.highlight(0),B();break;case CONSTANTS.KEYS.enter:i.isOpen&&(h.create&&i.search&&-1==i.highlighted?i.createOption(a.target.value):i.filteredOptions.length&&i.set(),a.preventDefault());break;case CONSTANTS.KEYS.backspace:if(!k.val()){var b=i.getObjValue(i.selectedValues.slice(-1)[0]||{},i.labelAttr||"");i.unset(),A(),i.softDelete&&!i.disableSearch&&c(function(){i.search=b}),a.preventDefault()}break;case CONSTANTS.KEYS.left:case CONSTANTS.KEYS.right:case CONSTANTS.KEYS.shift:case CONSTANTS.KEYS.ctrl:case CONSTANTS.KEYS.alt:case CONSTANTS.KEYS.tab:case CONSTANTS.KEYS.leftCmd:case CONSTANTS.KEYS.rightCmd:break;default:!i.multiple&&i.hasValue()?a.preventDefault():(A(),i.highlight(0))}},i.inOptions=function(a,b){return i.remote?a.filter(function(a){return angular.equals(b,a)}).length>0:a.indexOf(b)>=0};var C=function(){if(i.filteredOptions=j(i.options||[],i.search),angular.isArray(i.selectedValues)||(i.selectedValues=[]),i.multiple)i.filteredOptions=i.filteredOptions.filter(function(a){return!i.inOptions(i.selectedValues,a)});else{var a=i.filteredOptions.indexOf(i.selectedValues[0]);a>=0&&i.highlight(a)}};i.measureWidth=function(){var a,b=DOM_FUNCTIONS.getStyles(k[0]),c=angular.element('<span class="selector-shadow"></span>');return c.text(k.val()||(i.hasValue()?"":i.placeholder)||""),angular.element(document.body).append(c),angular.forEach(["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent"],function(a){c.css(a,b[a])}),a=c[0].offsetWidth,c.remove(),a},i.setInputWidth=function(){var a=i.measureWidth()+1;k.css("width",a+"px")},i.resetInput=function(){k.val(""),i.setInputWidth(),c(function(){i.search=""})},i.$watch("[search, options, value]",function(){C(),c(function(){i.setInputWidth(),i.isOpen&&i.dropdownPosition()})},!0),i.updateValue=function(a){angular.isDefined(a)||(a=i.selectedValues||[]),t(i.multiple?a:a[0])},i.$watch("selectedValues",function(a,b){angular.equals(a,b)||(i.updateValue(),angular.isFunction(i.change)&&i.change(i.multiple?{newValue:a,oldValue:b}:{newValue:(a||[])[0],oldValue:(b||[])[0]}))},!0),i.$watchCollection("options",function(a,b){angular.equals(a,b)||i.remote||D()});var D=function(){i.multiple?i.selectedValues=(i.value||[]).map(function(a){return j(i.options,function(b){return s(b,a)})[0]}).filter(function(a){return angular.isDefined(a)}).slice(0,i.limit):i.selectedValues=(i.options||[]).filter(function(a){return s(a)}).slice(0,1)};i.$watch("value",function(a,b){angular.equals(a,b)||f.when(i.remote&&i.remoteValidation&&i.hasValue()?w(a):angular.noop).then(function(){D(),C(),i.updateValue()})},!0),k=angular.element(g[0].querySelector(".selector-input input")).on("focus",function(){c(function(){i.$apply(A)})}).on("blur",function(){i.$apply(B)}).on("keydown",function(a){i.$apply(function(){i.keydown(a)})}).on("input",function(){i.setInputWidth()}),l.on("mousedown",function(a){a.preventDefault()}),angular.element(d).on("resize",function(){i.dropdownPosition()}),i.$watch(function(){return m.$pristine},function(a){n[a?"$setPristine":"$setDirty"]()}),i.$watch(function(){return m.$touched},function(a){n[a?"$setTouched":"$setUntouched"]()}),i.api.fetch=v,i.api.open=A,i.api.close=B,i.api.focus=function(){k[0].focus()},i.api.set=function(a){return i.value=a},i.api.unset=function(a){var b=a?(i.selectedValues||[]).filter(function(b){return s(b,a)}):i.selectedValues,c=i.selectedValues.map(function(a,c){return i.inOptions(b,a)?c:-1}).filter(function(a){return a>=0});angular.forEach(c,function(a,b){i.unset(a-b)})}})}}return a.Factory=function(){var b=function(b,c,d,e,f){return new a(b,c,d,e,f)};return b.$inject=["$filter","$timeout","$window","$http","$q"],b},a}();angular.module("selector",[]).run(["$templateCache",function(a){a.put("selector/selector.html",CONSTANTS.TEMPLATES.SELECTOR),a.put("selector/item-create.html",CONSTANTS.TEMPLATES.ITEM_CREATE),a.put("selector/item-default.html",CONSTANTS.TEMPLATES.ITEM_DEFAULT),a.put("selector/group-default.html",CONSTANTS.TEMPLATES.GROUP_DEFAULT)}]).directive("selector",SelectorDirective.Factory());